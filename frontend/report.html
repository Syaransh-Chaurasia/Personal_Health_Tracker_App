<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Full Health Report</title>
  <link rel="stylesheet" href="static/module.css">
</head>
<body>

<div class="sidebar">
  <h2>Navigation</h2>
  <ul>
    <li><a href="dashboard.html">Dashboard</a></li>
    <li><a href="medication.html">Medication</a></li>
    <li><a href="symptom.html">Symptoms</a></li>
    <li><a href="vitals.html">Vitals</a></li>
    <li><a href="report.html">Full Report</a></li>
    <li><a href="#" onclick="logout()" style="color:red;">Logout</a></li>
  </ul>
</div>

<main>
  <h1>Full Health Report</h1>

  <h2>Medications</h2>
  <table>
    <thead>
    <tr>
      <th>Name</th>
      <th>Dosage</th>
      <th>Frequency</th>
      <th>Time Slots</th>
      <th>Start</th>
      <th>End</th>
      <th>Taken?</th>
    </tr>
    </thead>
    <tbody id="medications-table"></tbody>
  </table>

  <h2>Symptoms</h2>
  <table>
    <thead>
    <tr>
      <th>Date</th>
      <th>Symptom</th>
      <th>Severity</th>
      <th>Notes</th>
    </tr>
    </thead>
    <tbody id="symptoms-table"></tbody>
  </table>

  <h2>Vitals</h2>
  <table>
    <thead>
    <tr>
      <th>Date</th>
      <th>Heart Rate</th>
      <th>Blood Pressure</th>
      <th>Temperature</th>
    </tr>
    </thead>
    <tbody id="vitals-table"></tbody>
  </table>

</main>

<script>
  const storedUser = JSON.parse(localStorage.getItem('user'));
  const token = storedUser ? storedUser.access_token : null;

  if (!token) {
    alert('Please login first.');
    window.location.href = 'index.html';
  }

  const apiBase = 'https://personal-health-tracker-app-2.onrender.com';

  async function loadMedications() {
    const res = await fetch(`${apiBase}/medications`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    const meds = await res.json();
    const tbody = document.getElementById('medications-table');
    tbody.innerHTML = '';

    meds.forEach(m => {
      tbody.innerHTML += `
        <tr>
          <td>${m.name}</td>
          <td>${m.dosage}</td>
          <td>${m.frequency}</td>
          <td>${m.time_slots}</td>
          <td>${m.start_date}</td>
          <td>${m.end_date}</td>
          <td>${m.taken ? 'Yes' : 'No'}</td>
        </tr>
      `;
    });
  }

  async function loadSymptoms() {
    const res = await fetch(`${apiBase}/symptoms`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    const symptoms = await res.json();
    const tbody = document.getElementById('symptoms-table');
    tbody.innerHTML = '';

    symptoms.forEach(s => {
      tbody.innerHTML += `
        <tr>
          <td>${s.date}</td>
          <td>${s.symptom_type}</td>
          <td>${s.severity}</td>
          <td>${s.notes || ''}</td>
        </tr>
      `;
    });
  }

  async function loadVitals() {
    const res = await fetch(`${apiBase}/vitals`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    const vitals = await res.json();
    const tbody = document.getElementById('vitals-table');
    tbody.innerHTML = '';

    vitals.forEach(v => {
      tbody.innerHTML += `
        <tr>
          <td>${v.date}</td>
          <td>${v.heart_rate} bpm</td>
          <td>${v.blood_pressure}</td>
          <td>${v.temperature} Â°C</td>
        </tr>
      `;
    });
  }

  function logout() {
    localStorage.removeItem('user');
    window.location.href = 'index.html';
  }

  loadMedications();
  loadSymptoms();
  loadVitals();
</script>

</body>
</html>
